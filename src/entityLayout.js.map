{"version":3,"sources":["entityLayout.ts"],"names":[],"mappings":"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","file":"entityLayout.js","sourcesContent":["import {LayoutRow} from \"./layoutRow\";\r\nimport {IEntity} from \"./IEntity\";\r\nimport {Entity} from \"./entity\";\r\nimport {LayoutColumn} from \"./layoutColumn\";\r\nimport {IEntityLayout} from \"./interfaces/IEntityLayout\";\r\n\r\n\r\nexport class EntityLayout {\r\n\r\n    private availableEntities: Array<Entity>;\r\n    public rows: Array<LayoutRow>;\r\n    private currentColumn: LayoutColumn;\r\n    private popup: HTMLDivElement;\r\n    private popupSelectArea: HTMLDivElement;\r\n    private div: HTMLDivElement;\r\n    private div_container: HTMLDivElement;\r\n    private numberColumns: number;\r\n    private copyAvailableEntities: Array<Entity>;\r\n\r\n    constructor(numberColumns: number) {\r\n        let self = this;\r\n        this.availableEntities = [];\r\n        this.copyAvailableEntities = [];\r\n        this.rows = [];\r\n        this.currentColumn = null;\r\n        this.numberColumns = numberColumns;\r\n        this.div = document.createElement(\"div\");\r\n        this.div.className = \"entity-layout\";\r\n        this.div_container = document.createElement(\"div\");\r\n        this.div_container.className = \"content-rows\";\r\n        this.div.appendChild(this.div_container);\r\n        \r\n        // Button Add rows\r\n        let add_row_btn = document.createElement(\"div\"); \r\n        add_row_btn.className = \"button-add-row\";\r\n        add_row_btn.addEventListener(\"click\", function() {\r\n              self.addRow();\r\n        });\r\n        this.div_container.appendChild(add_row_btn);\r\n\r\n        this.popup = document.createElement(\"div\");\r\n        this.popup.classList.add(\"EL-popup\");\r\n        let popupLayer = document.createElement(\"div\");\r\n        popupLayer.classList.add(\"layer\");\r\n        popupLayer.addEventListener(\"click\", function () {\r\n            self.popup.classList.remove(\"visible\");\r\n        });\r\n        let popupContent = document.createElement(\"div\");\r\n        popupContent.classList.add(\"content\");\r\n        let popupWraper = document.createElement(\"div\");\r\n        popupWraper.classList.add(\"wraper\");\r\n        let popupSelectArea = document.createElement(\"div\");\r\n        popupSelectArea.classList.add(\"selectArea\");\r\n        this.popupSelectArea = popupSelectArea;\r\n        this.popup.appendChild(popupLayer);\r\n        this.popup.appendChild(popupWraper);\r\n        popupWraper.appendChild(popupContent);\r\n        popupContent.appendChild(this.popupSelectArea);\r\n        document.body.appendChild(this.popup);\r\n    }\r\n\r\n    openPopup(col: LayoutColumn) {\r\n        let self = this;\r\n        this.currentColumn = col;\r\n        if (this.currentColumn.getEntity()) {\r\n            let ent = this.currentColumn.getEntity();\r\n            this.availableEntities.push(ent);\r\n        }\r\n        this.popupSelectArea.innerHTML = \"\";\r\n        let popupOption = document.createElement(\"div\");\r\n            popupOption.className = \"options-entity\";\r\n            popupOption.textContent = \"Delete entity...\";\r\n            popupOption.classList.add(\"delete\");\r\n            popupOption.addEventListener(\"click\", function () {\r\n                self.currentColumn.deleteEntity();\r\n                self.popup.classList.remove(\"visible\");\r\n            });\r\n            this.popupSelectArea.appendChild(popupOption);\r\n            this.availableEntities.forEach( ent =>{\r\n                let popupOption = document.createElement(\"div\");\r\n                popupOption.className = \"options-entity\";\r\n                popupOption.textContent = ent.id;\r\n                popupOption.addEventListener(\"click\", function () {\r\n                    if (self.currentColumn !== null) {\r\n                        self.currentColumn.setEntity(ent);\r\n                        self.availableEntities.splice(self.availableEntities.indexOf(ent), 1);\r\n                        self.copyAvailableEntities.push(ent);\r\n                    }\r\n                    self.popup.classList.remove(\"visible\");\r\n                });\r\n                this.popupSelectArea.appendChild(popupOption);\r\n            });\r\n        this.popup.classList.add(\"visible\");\r\n    }\r\n\r\n    addEntities(ents: Array<Entity>) {\r\n        this.rows.forEach( r => {\r\n            let columns =  r.getColumn();\r\n            columns.forEach( c => {\r\n                if (c.getEntity()) {\r\n                    let found = ents.some((ent):boolean => {\r\n                        return c.getEntity().id === ent.id;\r\n                    });\r\n                    if (!found) {\r\n                        c.deleteEntity();\r\n                    }\r\n                }\r\n            });\r\n        });\r\n        let self = this;\r\n        self.availableEntities = ents;\r\n    }\r\n    addRow(){\r\n\r\n        let r = new LayoutRow(this);\r\n        this.rows.push(r);\r\n        this.div_container.appendChild(r.div);\r\n        return r;\r\n    }\r\n\r\n    render() {\r\n        let div_rows = document.createElement(\"div\");\r\n        div_rows.style.width = \"21cm\";\r\n        div_rows.style.padding = \"1cm\";\r\n        div_rows.style.backgroundColor = \"#bebebe\";\r\n        this.rows.forEach(r => {\r\n           div_rows.appendChild(r.render());\r\n        });\r\n        // Cambiar!!\r\n        return \"<html><head><style type=\\\"text/css\\\"><\\/style><\\/head><body>\" + div_rows.outerHTML + \"<\\/body><\\/html>\";\r\n\r\n    };\r\n\r\n    serializer(): IEntityLayout {\r\n        return {\r\n            rows: this.rows.map(r => {\r\n                return r.serializer();\r\n            })\r\n        }\r\n    }\r\n\r\n    reset() {\r\n        let self = this;\r\n        this.rows.forEach(function (r) {\r\n            self.div_container.removeChild(r.div);\r\n            r.clear();\r\n        });\r\n        this.rows = [];\r\n    }\r\n    \r\n    clear() {\r\n        this.reset();\r\n        this.availableEntities = [];\r\n        this.copyAvailableEntities = [];\r\n        this.addRow();\r\n    }\r\n\r\n    parser(object: IEntityLayout) {\r\n        this.reset();\r\n        this.rows = object.rows.map(r => {\r\n            let row = new LayoutRow(this);\r\n            row.clear();\r\n            row.parser(r);\r\n            this.div_container.appendChild(row.div);\r\n            return row;\r\n        });\r\n    }\r\n\r\n    getEntities() {\r\n        return this.availableEntities;\r\n    }\r\n\r\n    getNumberColumns(){\r\n        return this.numberColumns;\r\n    }\r\n\r\n    assignEntity(id: string, col: LayoutColumn) {\r\n        if (id) {\r\n            let ent = this.availableEntities.filter(e => {return e.id === id})[0];\r\n            col.setEntity(ent);\r\n            this.availableEntities.splice(this.availableEntities.indexOf(ent), 1);\r\n            this.copyAvailableEntities.push(ent);\r\n        }\r\n    }\r\n\r\n    get_entity(){\r\n        return this.copyAvailableEntities;\r\n    }\r\n}"]}